---
import Layout from "../layouts/Layout.astro";
import apiData from "../data/api-data";
import { createQuestionUrl, getFullUrl, mapApiData } from "../utils/utils";
import type { ApiDataItem, QuestionPageData } from "../store/questions";

export async function getStaticPaths() {
  const categories = [..."a,b,c,d,t,am,a1,a2,b1,c1,d1,z".split(",")];

  const arrayToGeneratePages: any[] = [];

  categories.forEach((category) => {
    const arrayToGeneratePagesPerCategory = mapApiData(apiData as ApiDataItem[])
      .filter((q) => q.categories.includes(category))
      .map((q, index) => {
        const questionPageData: QuestionPageData = {
          ...q,
          slug: createQuestionUrl(q.id, category),
          category,
          prevSlug: null,
          nextSlug: null,
        };

        return {
          params: { question: createQuestionUrl(q.id, category) },
          props: { questionPageData },
        };
      });
    arrayToGeneratePages.push(...arrayToGeneratePagesPerCategory);
  });

  const arrayToGeneratePagesWithPrevNext = arrayToGeneratePages.map(
    (page, index) => {
      const prevPage = arrayToGeneratePages[index - 1];
      const nextPage = arrayToGeneratePages[index + 1];

      return {
        ...page,
        props: {
          ...page.props,
          questionPageData: {
            ...page.props.questionPageData,
            prevSlug: prevPage ? getFullUrl(prevPage.params.question) : null,
            nextSlug: nextPage ? getFullUrl(nextPage.params.question) : null,
          },
        },
      };
    }
  );
  


  // console log makes build long ?? 
  // arrayToGeneratePagesWithPrevNext.map((page, index) => {
  //   console.log(
  //     index,
  //     page.props.questionPageData.slug,
  //     page.props.questionPageData.prevSlug,
  //     page.props.questionPageData.nextSlug
  //   );

  //   return page;
  // });

  return arrayToGeneratePagesWithPrevNext;
}

const { id, text, category, prevSlug, nextSlug } = Astro.props.questionPageData;
---

<Layout>
  <p><a href={prevSlug}>poprzednie</a> | <a href={nextSlug}>nastÄ™pne</a></p>
  <h2>Kategoria: <strong>{category}</strong>, id: {id}</h2>
  <h1>{text}</h1>

  <pre>{JSON.stringify( Astro.params, null,2)}</pre>
  <pre>{JSON.stringify( Astro.props, null,2)}</pre>
</Layout>
